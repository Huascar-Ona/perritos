<div id="fileupload">
  <% if photo.errors.any? %>
    <div class="row" id="error_explanation">
      <h2><%= pluralize(photo.errors.count, "error") %> prohibited this photo from being saved:</h2>

      <ul>
        <% photo.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <%= simple_form_for photo, html: { multipart: true } do |f| %>
    <%= f.input :dog_id, as: :hidden, input_html: { value: @dogId} %>
    <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
    <div class="row fileupload-buttonbar">
      <div class="span7">
        <!-- The fileinput-button span is used to style the file input field as button -->
        <span class="btn btn-success fileinput-button">
          <i class="icon-plus icon-white"></i>
          <span>Add files...</span>
          <%= f.file_field :image, multiple: true %>
        </span>
        <button type="submit" class="btn btn-primary start">
          <i class="icon-upload icon-white"></i>
          <span>Start upload</span>
        </button>
        <button type="reset" class="btn btn-warning cancel">
          <i class="icon-ban-circle icon-white"></i>
          <span>Cancel upload</span>
        </button>
        <button type="button" class="btn btn-danger delete">
          <i class="icon-trash icon-white"></i>
          <span>Delete</span>
        </button>
      </div>
    </div>
    
  <% end %>
  <div class="fileupload-content">
      <table class="files"></table>
      <div class="fileupload-progressbar"></div>
    </div>
</div>
<script id="template-upload" type="text/x-jquery-tmpl">
  <tr class="template-upload{{if error}} ui-state-error{{/if}}">
      <td class="preview"></td>
      <td class="name">${name}</td>
      <td class="size">${sizef}</td>
      {{if error}}
          <td class="error" colspan="2">Error:
              {{if error === 'custom_failure'}}Custom Error Message
              {{else}}${error}
              {{/if}}
          </td>
      {{else}}
          <td class="progress"><div></div></td>
          <td class="start"><button>Start</button></td>
      {{/if}}
      <td class="cancel"><button>Cancel</button></td>
  </tr>
</script>
<script id="template-download" type="text/x-jquery-tmpl">
  <tr class="template-download{{if error}} ui-state-error{{/if}}">
      {{if error}}
          <td></td>
          <td class="name">${name}</td>
          <td class="size">${sizef}</td>
          <td class="error" colspan="2">Error:
              {{if error === 1}
              {{else}}${error}
              {{/if}}
          </td>
      {{else}}
          <td class="preview">
              {{if thumbnail_url}}
                  <a href="${url}" target="_blank"><img src="${thumbnail_url}"></a>
              {{/if}}
          </td>
          <td class="name">
              <a href="${url}"{{if thumbnail_url}} target="_blank"{{/if}}>${name}</a>
          </td>
          <td class="size">${sizef}</td>
          <td colspan="2"></td>
      {{/if}}
      <td class="delete">
          <button data-type="${delete_type}" data-url="${delete_url}">Delete</button>
      </td>
  </tr>
</script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js"></script>
<script src="//ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>

<%= javascript_include_tag 'jquery-fileupload/vendor/load-image.all.min' %>
<%= javascript_include_tag 'jquery-fileupload/vendor/canvas-to-blob' %>
<%= javascript_include_tag 'jquery-fileupload/vendor/jquery.ui.widget' %>
<%= javascript_include_tag 'jquery-fileupload/jquery.iframe-transport' %>
<%= javascript_include_tag 'jquery-fileupload/jquery.fileupload' %>
<%= javascript_include_tag 'jquery-fileupload/jquery.fileupload-process' %>
<%= javascript_include_tag 'jquery-fileupload/jquery.fileupload-image' %>
<%= javascript_include_tag 'jquery-fileupload/jquery.fileupload-validate' %>
<%= javascript_include_tag 'jquery-fileupload/jquery.fileupload-ui' %>






<script type="text/javascript" charset="utf-8">
  $(function () {
    // Initialize the jQuery File Upload widget:
    $('#fileupload').fileupload();
    // 
    // Load existing files:
    $.getJSON($('#fileupload form').prop('action'), function (files) {
        var fu = $('#fileupload').data('blueimpFileupload'), template;
        // fu._adjustMaxNumberOfFiles(-files.length);
        fu._renderDownload(files)
            .appendTo($('#fileupload .files'))
            .fadeIn(function () {
                // Fix for IE7 and lower:
                $(this).show();
            }); 
    });

    // Open download dialogs via iframes,
    // to prevent aborting current uploads:
    $('#fileupload .files a:not([target^=_blank])').live('click', function (e) {
        e.preventDefault();
        $('<iframe style="display:none;"></iframe>')
            .prop('src', this.href)
            .appendTo('body');
    });
  });
</script>